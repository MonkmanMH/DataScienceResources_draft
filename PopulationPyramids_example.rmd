---
title: "population pyramids: an animated example"
output: html_notebook
---

Population pyramids are one of the familiar data viz options in the demographer's tool box.

[Kyle Walker](http://personal.tcu.edu/kylewalker/)'s post ["idbr: access the US Census Bureau International Data Base in R"](http://www.arilamstein.com/blog/2016/06/06/idbr-access-us-census-bureau-international-data-base-r) uses international data to create animated population pyramids.

Below, I plagarize the code to create an animated population pyramid for British Columbia.


### The original code

**Notes:** 

* The program requires the `gganimate` package, which is not on [CRAN](https://cran.r-project.org/web/packages/available_packages_by_name.html#available-packages-G) at the time of this writing (2017-05-07). To install the package into your library, follow the directions on the [`gganimate` github page](https://github.com/dgrtwo/gganimate). See also (https://rpubs.com/omicsdata/gganimate).


```{r}

library(gapminder)
library(ggplot2)

library(animation)
library(gganimate)

library(dplyr)

theme_set(theme_bw())

p <- ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, color = continent, frame = year)) +
  geom_point() +
  scale_x_log10()

p

ani.options(convert = shQuote('C:/PGMS/ImageMagick-7.0.5-Q16/magick.exe'))

gganimate(p)




```


* You will also need a separate program, Image Magick, and an associated R package, `magick`.
OR DO YOU?

https://www.imagemagick.org/script/index.php


Link R to ImageMagick
http://stackoverflow.com/questions/37800390/linking-r-to-imagemagick



* the `magick` package 



[CRAN page](https://cran.r-project.org/web/packages/magick/vignettes/intro.html)

[Ropensci entry](https://ropensci.org/blog/2016/08/23/z-magick-release)


```{r}

install.packages("magick")
library(magick)


# the tiger example
# from https://cran.r-project.org/web/packages/magick/vignettes/intro.html


tiger <- image_read('http://jeroen.github.io/images/tiger.svg')
image_info(tiger)

tiger

# Render svg to png bitmap
image_write(tiger, path = "tiger.png", format = "png")

# convert format
tiger_png <- image_convert(tiger, "png")


```


* "A Census API key is required.  Obtain one at http://api.census.gov/data/key_signup.html, and then supply the key to the `idb_api_key` function to use it throughout your idbr session."

---


```{r}

# image 1
library(idbr) 
library(ggplot2)
library(dplyr)
library(gganimate)
library(animation)

library(magick)
library(readr)

# Census API key
idb_api_key("725c5ae0a596294bb619ef881a121c542a89a70d")

male <- idb1('NI', 1990:2050, sex = 'male') %>%
  mutate(POP = POP * -1,
         SEX = 'Male')

female <- idb1('NI', 1990:2050, sex = 'female') %>%
  mutate(SEX = 'Female')

nigeria <- rbind(male, female) 

write_csv(nigeria, "nigeria.csv")

# Animate it with gganimate


gganimate(g1, interval = 0.1, ani.width = 700, ani.height = 600)

gganimate(g1, interval = 0.1, ani.width = 700, ani.height = 600, "output.gif")

```

